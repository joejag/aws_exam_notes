## S3 (Simple Storage Service)

- Object based. Max filesize of 5Tb. Universal namespace (within a partition, gov and china ones exist too). URLs has region unless in Virginia. https://joe.s3.amazonaws.com
- S3 Object has: key (name), value (bytes), versionId, metadata, sub-resources (ACL, Torrent)
- Data consistency: PUTs on new objects are immediately available. Eventual for overwrites and deletes
- S3 Guarantees: 99.99% uptime, 99.9% SLA. 11 9s durability
- S3 featuers: has tiered storage, lifecycle management (move tiers), versioning, encyption, MFA delete, secure via ACL and policies
- Storage classes (first byte latency, availability, cost are the levers):
  - S3 Standard: 99.99% uptime, 11 9s durability. Multiple AZs (can lose two AZs)
  - S3 - IA: lower storage cost, but adds retrieval costs (once a month data)
  - S3 One Zone - IA: really low cost, can sustain loss
  - S3 Intelligent Tiering: Machine learning to auto-move objects
  - S3 Glacier: super cheap, stuff you need for 7 years. Retrival: mins or hours by choice
  - S3 Glacier deep archive: cheapest, 12 hour retrieval
- Billed: Storage, requests, storage management pricing (tiers), data transfer, transfer acceleratin (Cloudfront, good for uploads), cross-region replication (HA, disaster recovery)
- Max 100 buckets per account. No limit on objects in the bucket. Don't make buckets from code, use infra as code
- Don't use it for block storage (databases, OSes). HTTP 200 on succesful requests
- Older service called "RRS" which is now IA
- Read the S3 FAQs before the exam

## S3 - creating a bucket

- Historically folks were accidenataly making their buckets public and shouting at Amazon
- Storage class can be done at an object level
- Restricting Access:
  - Bucket Policy - whole bucket
  - Object Policy - individual files
  - IAM Polices for users / groups

## S3 - pricing tiers

- Intelligent Tiering incurs a monitoring cost per 1000 objects
- Intelligent moves between Standard and IA (use this), cheaper for one zone.
- Use S3 Intelligent Tiering unless you have millions of objects
- If you don't care about redundency use S3 - One zone - IA
- If you don't care about access time use Glacier

## S3 - Security and Encryption

- buckets an private by default. Can be configured to create access logs in another account's bucket
- Two types of encryption:
  - In Transit (TLS)
  - At rest (if someone steals the hard disk they could get the file)
    - server side (AWS do it):
      - S3 Managed Keys (SSE-S3 - all AWS)
      - AWS Key Managed Service (SSE-KMS - AWS and you)
      - Server side with customer provided (SSE-C - you give AWS keys to use)
    - client side (you do it)

## S3 - Versioning

- Keeps deleted objects. Versioning can only be enabled - not disabled (can suspend)
- MFA delete is here - but you cannot enable it via the console
- When you upload a new version it doesn't inherit public access. Each version needs to be made public
- When you delete it leaves a 'marker' which you can then delete to restore the file
- You can delete older versions of files

## S3 - Lifecycle Management

- Allows you to automate moving objects between storage tiers
- Versioning doesn't need to be turned on to use it
- Can filter for all objects, or a folder or file extension
- Allows you to change tier after a certain amoint of days (plus for older versions)
- Can delete older version after an amount of days
- Shows a cool Timeline at the bottom

# S3 - Object Lock and Glacier Vault Lock

- WORM: Write Once Read Many - fixed time or indefinetley
- Modes:
  - Governance: Need special perm to overwrite or alter the lock status
  - Compliance: Cannot be deleted by anyone
- Retention Period can be set, expiry is stored in the object metadata
- Legal Hold: Like a lock, not time bound
- Glaicer: Vault Lock: Policy cannot be changed
- You need to set object lock when first making the bucket

# S3 - Performance

- S3 prefix: folder the object lives in (so no bucket or file name included)
- first byte in S3 is 100-200ms. 3,500 writes a second and 5,500 reads per prefix
- You get linear scaling by adding prefixes
- KMS limits per region. 5k, 10k or 30k (you cannot ask for this to be raised)
- (uploads) Multipart uploads: for files over 100mb, required for over 5gb, parralllize uploads
- (downloads) S3 Byte-Range Fetches: download a range, on failure. Also allows partial file download (headers)

# S3 - S3 Select and Glacier Select

- SQL for CSV files. Saves downloading zipped CSVs
- Glacier Select: Same deal, Glacier.
- Can get columns and rows. Saves transfer costs and faster
- Not available via the Console

# S3 - Share buckets across accounts

- Three ways to share buckets across accounts
  - Bucket Policies & IAM - whole bucket - API only
  - Bucket ACLs & IAM - objects in buckets - API only
  - Cross account IAM roles - API and Console
- Cross Account - IAM > Create Role > Another AWS Account
- After creating a non-root account you can "Switch role" from the menu

# S3 - Cross Region Replication

- Requires versioning to work
- can change the storage class for replicated objects
- does not immediately replicate objects, only subsequent uploads
- does not take older versions of files across
- does not take "make public" across
- delete markers or versions are not replicated

# S3 - Transfer Acceleration

- For uploads, you get your own URL
- AWS has a tool to test it "s3 transfer acceleration tool"
- not useful for users near the edge location, but very uesful for large uploads from other parts of the world
